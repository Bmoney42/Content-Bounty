import{u as U,F as E,S as n,j as e}from"./index-Cp-zpohs.js";import{r as i}from"./router-DCicCOur.js";import{B as P}from"./Button-CbNmxST3.js";import{X as L,am as A,h as B,Z as R,j as F}from"./ui-D4EKNBIH.js";const I=()=>{const{user:t}=U(),{addToast:l}=E(),[o,u]=i.useState(null),[s,m]=i.useState(null),[p,h]=i.useState(!0),[y,c]=i.useState([]),x=i.useCallback(async()=>{if(t?.id)try{h(!0);const[r,d,T]=await Promise.all([n.getUserSubscription(t.id),n.getSubscriptionUsage(t.id,t.userType||"creator"),n.getUpgradePrompts(t.id,t.userType||"creator")]);u(r),m(d),c(T)}catch(r){console.error("Error loading subscription:",r)}finally{h(!1)}},[t?.id,t?.userType]),f=i.useCallback(async()=>t?.id?await n.canApplyToBounty(t.id):!1,[t?.id]),j=i.useCallback(async()=>t?.id?await n.canCreateBounty(t.id):!1,[t?.id]),N=i.useCallback(async r=>{if(!t?.id||!t?.email){l({type:"error",title:"Error",message:"Please log in to upgrade your subscription."});return}try{await n.createCheckoutSession(r,t.id,t.email)}catch(d){console.error("Error upgrading subscription:",d),l({type:"error",title:"Upgrade Failed",message:"Failed to start the upgrade process. Please try again."})}},[t?.id,t?.email,l]),k=i.useCallback(async()=>{if(!o?.stripeCustomerId){l({type:"error",title:"Error",message:"No subscription found to manage."});return}try{await n.createCustomerPortalSession(o.stripeCustomerId)}catch(r){console.error("Error opening customer portal:",r),l({type:"error",title:"Error",message:"Failed to open subscription management. Please try again."})}},[o?.stripeCustomerId,l]),w=i.useCallback(async()=>{if(!(!t?.id||!s))try{const r={...s,applicationsUsed:s.applicationsUsed+1};await n.updateSubscriptionUsage(t.id,r),m(r)}catch(r){console.error("Error updating application count:",r)}},[t?.id,s]),C=i.useCallback(async()=>{if(!(!t?.id||!s))try{const r={...s,bountiesCreated:s.bountiesCreated+1};await n.updateSubscriptionUsage(t.id,r),m(r)}catch(r){console.error("Error updating bounty count:",r)}},[t?.id,s]),g=i.useCallback(async r=>{if(!(!t?.id||!s))try{const d={...s,totalEarnings:s.totalEarnings+r};await n.updateSubscriptionUsage(t.id,d),m(d)}catch(d){console.error("Error updating earnings:",d)}},[t?.id,s]),a=i.useCallback(r=>n.getSubscriptionPlan(r),[]),b=i.useCallback(()=>n.getAllSubscriptionPlans(),[]),v=o?.tier==="premium",S=o?.status==="active";return i.useEffect(()=>{x()},[x]),{subscription:o,usage:s,loading:p,upgradePrompts:y,isPremium:v,isActive:S,loadSubscription:x,canApplyToBounty:f,canCreateBounty:j,upgradeToPremium:N,manageSubscription:k,incrementApplicationCount:w,incrementBountyCount:C,updateEarnings:g,getSubscriptionPlan:a,getAllSubscriptionPlans:b,applicationsRemaining:s?s.applicationsLimit===-1?-1:s.applicationsLimit-s.applicationsUsed:0,bountiesRemaining:s?s.bountiesLimit===-1?-1:s.bountiesLimit-s.bountiesCreated:0,hasReachedApplicationLimit:s?s.applicationsUsed>=s.applicationsLimit:!1,hasReachedBountyLimit:s?s.bountiesCreated>=s.bountiesLimit:!1}},_=({isOpen:t,onClose:l,trigger:o="manual"})=>{const{user:u}=U(),{upgradeToPremium:s,getAllSubscriptionPlans:m,usage:p,isPremium:h,upgradePrompts:y}=I(),[c,x]=i.useState(""),[f,j]=i.useState(!1),N=m();N.find(a=>a.id.includes(u?.userType||"creator"));const k=N.filter(a=>u?.userType==="creator"?a.id.includes("creator"):u?.userType==="business"?a.id.includes("business"):!1),w=async()=>{if(c){j(!0);try{await s(c)}catch(a){console.error("Upgrade failed:",a)}finally{j(!1)}}},g=(()=>{switch(o){case"application_limit":return{title:"Application Limit Reached",subtitle:"Upgrade to apply to unlimited bounties",icon:e.jsx(F,{className:"w-8 h-8 text-blue-500"})};case"bounty_limit":return{title:"Bounty Limit Reached",subtitle:"Upgrade to create unlimited bounties",icon:e.jsx(R,{className:"w-8 h-8 text-green-500"})};default:return{title:"Upgrade to Premium",subtitle:"Unlock unlimited opportunities and better earnings",icon:e.jsx(B,{className:"w-8 h-8 text-purple-500"})}}})();return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-3xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[g.icon,e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:g.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:g.subtitle})]})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(L,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[p&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Current Usage This Month"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Applications"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[p.applicationsUsed,"/",p.applicationsLimit===-1?"∞":p.applicationsLimit]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Platform Fees"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"0%"})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Choose Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:k.map(a=>e.jsxs("div",{className:`border-2 rounded-lg p-4 cursor-pointer transition-all ${c===a.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,onClick:()=>x(a.id),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:a.name}),e.jsxs("span",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["$",a.price,"/month"]})]}),e.jsx("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-300",children:a.features.map((b,v)=>e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsx("span",{children:b})]},v))})]},a.id))})]}),u?.userType==="creator"&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Premium Benefits"}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 p-6 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Unlock unlimited opportunities with premium:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:"∞"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Applications"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"0%"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Platform Fees"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:"Priority"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Placement"})]})]})]})]}),y.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Why Upgrade Now?"}),e.jsx("div",{className:"space-y-3",children:y.map((a,b)=>e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:a.message})},b))})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:c?e.jsxs("span",{children:["Selected: ",k.find(a=>a.id===c)?.name]}):e.jsx("span",{children:"Choose a plan to continue"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(P,{onClick:l,variant:"outline",size:"sm",children:"Cancel"}),e.jsx(P,{onClick:w,disabled:!c||f,size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:f?"Processing...":"Upgrade Now"})]})]})})]})}):null};export{_ as U,I as u};
