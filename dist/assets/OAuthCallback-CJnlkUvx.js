import{u as g,j as e}from"./index-Cp-zpohs.js";import{d as p,a as f,r as m}from"./router-DCicCOur.js";import{s as w}from"./socialMedia-B7rhQ8hh.js";import{R as b,a as y,C as j}from"./ui-D4EKNBIH.js";import"./vendor-gH-7aFTg.js";import"./firebase-DxBuhNaX.js";const v=()=>{const[n]=p(),u=f(),{user:c}=g(),[i,r]=m.useState("loading"),[d,a]=m.useState("");m.useEffect(()=>{(async()=>{try{const o=n.get("code"),t=n.get("state");if(n.get("error")){r("error"),a("Authentication was cancelled or failed");return}if(!o||!t){r("error"),a("Invalid OAuth response");return}if(!c?.id){r("error"),a("User not authenticated");return}const s=await x(o,t,c.id);s?(r("success"),a(`${t} account connected successfully!`)):(r("error"),a(`Failed to connect ${t} account`)),setTimeout(()=>{window.opener?(window.opener.postMessage({type:"OAUTH_SUCCESS",platform:t,success:s},window.location.origin),window.close()):u("/profile")},2e3)}catch(o){console.error("OAuth callback error:",o),r("error"),a("Failed to complete authentication")}})()},[n,u,c]);const x=async(h,o,t)=>{try{if(o==="youtube"){const s=await(await fetch("/api/oauth/youtube",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:h,userId:t})})).json();if(s.access_token)return await w.connectYouTube(t,s.access_token);s.error&&console.error("OAuth API error:",s.error)}return!1}catch(l){return console.error("Error exchanging code for token:",l),!1}};return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[i==="loading"&&e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-12 h-12 text-blue-500 animate-spin mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Connecting Account"}),e.jsx("p",{className:"text-gray-600",children:"Please wait while we complete the authentication..."})]}),i==="success"&&e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Success!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:d}),e.jsx("p",{className:"text-sm text-gray-500",children:"This window will close automatically..."})]}),i==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Connection Failed"}),e.jsx("p",{className:"text-gray-600 mb-4",children:d}),e.jsx("button",{onClick:()=>window.close(),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Close Window"})]})]})})};export{v as default};
